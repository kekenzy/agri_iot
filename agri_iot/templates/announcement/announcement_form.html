{% extends 'base.html' %}
{% load static %}

{% block title %}{% if announcement %}ãŠçŸ¥ã‚‰ã›ç·¨é›†{% else %}ãŠçŸ¥ã‚‰ã›ä½œæˆ{% endif %}{% endblock %}

{% block content %}
<div class="management-container">
    <div class="page-header">
        <div class="header-content">
            <h1 class="page-title">{% if announcement %}ãŠçŸ¥ã‚‰ã›ç·¨é›†{% else %}ãŠçŸ¥ã‚‰ã›ä½œæˆ{% endif %}</h1>
            <p class="page-subtitle">{% if announcement %}ãŠçŸ¥ã‚‰ã›ã®å†…å®¹ã‚’ç·¨é›†ã—ã¾ã™{% else %}æ–°ã—ã„ãŠçŸ¥ã‚‰ã›ã‚’ä½œæˆã—ã¾ã™{% endif %}</p>
        </div>
        <div class="header-actions">
            <a href="{% url 'agri_app:announcement_list' %}" class="btn-secondary">
                <span class="btn-icon">â†</span>
                æˆ»ã‚‹
            </a>
        </div>
    </div>

    <div class="card">
        <form method="post" class="announcement-form">
            {% csrf_token %}
            
            <div class="form-section">
                <h2 class="section-title">åŸºæœ¬æƒ…å ±</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">
                            ã‚¿ã‚¤ãƒˆãƒ« <span class="required">*</span>
                        </label>
                        {{ form.title }}
                        {% if form.title.errors %}
                            <div class="error-message">{{ form.title.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            å„ªå…ˆåº¦ <span class="required">*</span>
                        </label>
                        {{ form.priority }}
                        {% if form.priority.errors %}
                            <div class="error-message">{{ form.priority.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">ãŠçŸ¥ã‚‰ã›å†…å®¹</h2>
                <div class="form-group full-width">
                    <label class="form-label">
                        å†…å®¹ <span class="required">*</span>
                    </label>
                    {{ form.content }}
                    {% if form.content.errors %}
                        <div class="error-message">{{ form.content.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">è¡¨ç¤ºæœŸé–“</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">
                            é–‹å§‹æ—¥æ™‚ <span class="required">*</span>
                        </label>
                        {{ form.start_date }}
                        {% if form.start_date.errors %}
                            <div class="error-message">{{ form.start_date.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            çµ‚äº†æ—¥æ™‚ <span class="required">*</span>
                        </label>
                        {{ form.end_date }}
                        {% if form.end_date.errors %}
                            <div class="error-message">{{ form.end_date.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">å¯¾è±¡ã‚°ãƒ«ãƒ¼ãƒ—</h2>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="is_all_groups" name="is_all_groups" {% if form.is_all_groups.value %}checked{% endif %}>
                        å…¨ã¦ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«è¡¨ç¤º
                    </label>
                </div>
                
                <div class="form-group" id="target_groups_container">
                    <label class="form-label">
                        å¯¾è±¡ã‚°ãƒ«ãƒ¼ãƒ—
                    </label>
                    {{ form.target_groups }}
                    {% if form.target_groups.errors %}
                        <div class="error-message">{{ form.target_groups.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">è¡¨ç¤ºè¨­å®š</h2>
                <div class="form-group">
                    <label class="form-label">
                        {{ form.is_active }}
                        æœ‰åŠ¹ã«ã™ã‚‹
                    </label>
                    {% if form.is_active.errors %}
                        <div class="error-message">{{ form.is_active.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-primary">
                    <span class="btn-icon">ğŸ’¾</span>
                    {% if announcement %}æ›´æ–°{% else %}ä½œæˆ{% endif %}
                </button>
                <a href="{% url 'agri_app:announcement_list' %}" class="btn-secondary">
                    <span class="btn-icon">âŒ</span>
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </a>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const isAllGroupsCheckbox = document.getElementById('is_all_groups');
    const targetGroupsContainer = document.getElementById('target_groups_container');
    const targetGroupsSelect = targetGroupsContainer.querySelector('select');

    function toggleTargetGroups() {
        if (isAllGroupsCheckbox.checked) {
            targetGroupsContainer.style.opacity = '0.5';
            targetGroupsContainer.style.pointerEvents = 'none';
            // é¸æŠã‚’ã‚¯ãƒªã‚¢
            Array.from(targetGroupsSelect.options).forEach(option => {
                option.selected = false;
            });
        } else {
            targetGroupsContainer.style.opacity = '1';
            targetGroupsContainer.style.pointerEvents = 'auto';
        }
    }

    isAllGroupsCheckbox.addEventListener('change', toggleTargetGroups);
    toggleTargetGroups(); // åˆæœŸçŠ¶æ…‹ã‚’è¨­å®š
});
</script>
{% endblock %} 